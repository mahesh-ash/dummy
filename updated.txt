import React, { useRef, useState, useMemo, useEffect } from 'react';
import { AsyncTypeahead } from 'react-bootstrap-typeahead';
import { AgGridReact } from '@ag-grid-community/react';
import { ColumnsToolPanelModule } from '@ag-grid-enterprise/column-tool-panel';
import { SetFilterModule } from '@ag-grid-enterprise/set-filter';
import { MenuModule } from '@ag-grid-enterprise/menu';
import { ClientSideRowModelModule } from '@ag-grid-community/client-side-row-model';
import { Eye, Pencil, Trash2, Plus, Download, CircleDot, CheckCircle2, Clock, RefreshCcw, RefreshCcwIcon } from 'lucide-react';
import { Menu, MenuItem } from 'react-bootstrap-typeahead';
import { ChevronDownCircle } from 'lucide-react';
import httpClient from '@/common/helpers/httpClient';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';
import { Sheet, SheetContent, SheetHeader, SheetTitle, SheetFooter } from '@/components/ui/sheet';
import { Button } from '@/components/ui/button';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { Calendar } from '@/components/ui/calendar';
import { CalendarIcon } from 'lucide-react';
import { Form, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from '@/components/ui/select';
import { useForm } from 'react-hook-form';
import { Checkbox } from '@/components/ui/checkbox';
import { Input } from '@/components/ui/input';
import { toast } from 'sonner';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';
import { IS_DARK } from '@/store/signals';
import { useSignals } from '@preact/signals-react/runtime';
import { DateRangePicker } from '../common/DateRangePicker';

const defaultColDef = {
	sortable: true,
	editable: false,
	flex: 1,
	filter: 'agTextColumnFilter',
	floatingFilter: true,
	cellStyle: {
		whiteSpace: 'nowrap',
		overflow: 'hidden',
		textOverflow: 'ellipsis',
	},
};

const columns = [
	{
		headerName: 'Account Name',
		field: 'accountName',
		filterParams: {
			filterPlaceholder: (params) => {
				return 'Search Account Name';
			},
		},
		lockVisible: true,
	},
	{ headerName: 'Account ID', field: 'accountId', cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
	{ headerName: 'Invoice Date', field: 'date', headerClass: 'justify-center', filter: false, cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
	{ headerName: 'Commission', field: 'commission', cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
	{ headerName: 'Status', field: 'status', cellRenderer: 'StatusCellRenderer', cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
	{ headerName: 'Invoice', field: 'invoice', cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
	{ headerName: 'Notes', field: 'notes' },
	{
		headerName: 'Action',
		field: 'action',
		filter: false,
		sortable: false,
		editable: false,
		menuTabs: [],
		cellRenderer: 'ActionCellRenderer',
		pinned: 'right',
		minWidth: 120,
		maxWidth: 140,
		filter: false,
		sortable: false,
		lockVisible: true,
		suppressHeaderMenuButton: true,
		cellStyle: { display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '0.5rem' },
	},
];

function DefaultCellRenderer(props) {
	const col = props.colDef;
	if (col.field === 'invoice') {
		return (
			<div className={col.className + ' relative flex items-center'} style={col.cellStyle} title={props.value}>
				<span>{props.value}</span>
				<button
					type="button"
					className="ml-2 text-blue-500 hover:text-blue-700 transition-colors"
					style={{ background: 'none', border: 'none', cursor: 'pointer' }}
					title="Download Invoice"
					onClick={() => {
						toast.success('Download Completed');
					}}
				>
					<Download size={18} />
				</button>
			</div>
		);
	}
	return (
		<div className={col.className} style={col.cellStyle} title={props.value}>
			{props.value}
		</div>
	);
}

function StatusCellRenderer(props) {
	const status = props.value;
	const isDark = IS_DARK.value;
	let color = isDark ? 'bg-gray-800 text-gray-200' : 'bg-gray-200 text-gray-800';
	let icon = <CircleDot size={16} className={isDark ? 'mr-1 text-gray-400' : 'mr-1'} />;
	if (status === 'Open') {
		color = isDark ? 'bg-yellow-900 text-yellow-200' : 'bg-yellow-100 text-yellow-800';
		icon = <Clock size={16} className={isDark ? 'mr-1 text-yellow-300' : 'mr-1 text-yellow-600'} />;
	}
	if (status === 'Paid') {
		color = isDark ? 'bg-green-900 text-green-200' : 'bg-green-100 text-green-800';
		icon = <CheckCircle2 size={16} className={isDark ? 'mr-1 text-green-300' : 'mr-1 text-green-600'} />;
	}
	if (status === 'Pending') {
		color = isDark ? 'bg-blue-900 text-blue-200' : 'bg-blue-100 text-blue-800';
		icon = <CircleDot size={16} className={isDark ? 'mr-1 text-blue-300' : 'mr-1 text-blue-600'} />;
	}
	return (
		<span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold gap-1 ${color}`} style={{ minWidth: 80 }}>
			{icon}
			{status}
		</span>
	);
}

export default function ManageInvoiceTable(props) {
	useSignals();
	
	// Loading states
	const [isLoadingData, setIsLoadingData] = useState(false);
	const [isSaving, setIsSaving] = useState(false);
	
	// Typeahead for Account Name
	const [accountOptions, setAccountOptions] = useState([]);
	const [accountQuery, setAccountQuery] = useState('');
	const [selectedAccount, setSelectedAccount] = useState([]);

	// Grid and sheet states
	const gridRef = useRef();
	const [rowData, setRowData] = useState([]);
	const { sheetOpen, setSheetOpen } = props;
	const [showUnsavedDialog, setShowUnsavedDialog] = useState(false);
	const [editingRow, setEditingRow] = useState(null);
	const [showDeleteDialog, setShowDeleteDialog] = useState(false);
	const [rowToDelete, setRowToDelete] = useState(null);

	// Coverage states
	const masterCoverageOptions = [
		{ name: 'John Doe', role: 'Manager', coverageStart: '2025/01/01', coverageEnd: '2025/12/31' },
		{ name: 'Jane Smith', role: 'Analyst', coverageStart: '2025/03/01', coverageEnd: '2025/09/30' },
		{ name: 'Acme Corp', role: 'Partner', coverageStart: '2025/05/01', coverageEnd: '2025/11/30' },
	];
	const [search, setSearch] = useState('');
	const [showDropdown, setShowDropdown] = useState(false);
	const [selectedCoverage, setSelectedCoverage] = useState(null);
	const [percentage, setPercentage] = useState('');
	const [coverageRows, setCoverageRows] = useState([]);
	const [coverageError, setCoverageError] = useState('');
	const [percentageInputError, setPercentageInputError] = useState('');

	const filteredOptions = masterCoverageOptions.filter((opt) => opt.name.toLowerCase().includes(search.toLowerCase()));

	useEffect(() => {
		if (percentageInputError != '') {
			toast.error(percentageInputError);
		}
	}, [percentageInputError]);

	// Fetch invoice data on component mount
	useEffect(() => {
		fetchInvoiceData();
	}, []);

	// Function to fetch invoice data from API
	const fetchInvoiceData = async () => {
		setIsLoadingData(true);
		try {
			const response = await httpClient.get('/commission/GetCommissions');
			
			// Transform API data to match table structure
			const transformedData = response.data.map((item) => ({
				accountName: item.account_name || '',
				accountId: item.account_id || '',
				date: item.comm_date || '',
				commission: item.commission ? `$${item.commission}` : '$0',
				status: item.comm_status || 'Open',
				invoice: item.comm_no || '',
				notes: item.comments || '',
				product: item.product || '',
				ticker: item.ticker || '',
				quantity: item.quantity || '',
				price: item.price || '',
				payOut: item.payOut || false,
				netAmount: item.net_amount || '',
				empSplits: item.emp_splits || '',
				// Store original data for editing
				_originalData: item,
			}));
			
			setRowData(transformedData);
			toast.success('Data loaded successfully');
		} catch (error) {
			console.error('Error fetching invoice data:', error);
			toast.error('Failed to load data');
			setRowData([]);
		} finally {
			setIsLoadingData(false);
		}
	};

	// Dummy search for Account Name (replace with actual API call if needed)
	async function handleAccountSearch(query) {
		setAccountQuery(query);
		try {
			// Replace with actual API endpoint for account search
			// const response = await httpClient.get(`/accounts/search?q=${query}`);
			// setAccountOptions(response.data);
			
			// For now, using local filter (replace this with API call)
			const dummyAccounts = [
				{ accountName: 'John Doe', id: 'ACC123' },
				{ accountName: 'Jane Smith', id: 'ACC456' },
				{ accountName: 'Acme Corp', id: 'ACC789' },
				{ accountName: 'Global Partners', id: 'ACC321' },
			];
			setAccountOptions(dummyAccounts.filter((opt) => opt.accountName.toLowerCase().includes(query.toLowerCase())));
		} catch (error) {
			console.error('Error searching accounts:', error);
		}
	}

	function dateRangeHandler(fromDate, toDate) {
		// Implement date range filtering
		console.log('Date range:', fromDate, toDate);
	}
	
	function dateRangeCancelHandler() {
		// Reset date range filter
	}

	function handleAccountChange(selected) {
		setSelectedAccount(selected);
		setCoverageRows([
			{ name: 'John Doe', role: 'Manager', coverageStart: '2025/01/01', coverageEnd: '2025/12/31', percentage: 0 },
			{ name: 'Jane Smith', role: 'Analyst', coverageStart: '2025/03/01', coverageEnd: '2025/09/30', percentage: 0 },
		]);
		if (selected.length > 0) {
			form.setValue('accountname', selected[0].accountName);
		}
	}

	function renderAccountMenu(results, menuProps) {
		if (accountQuery.length === 0 && accountOptions.length === 0) {
			return null;
		}
		const items = results.map((result, index) => {
			if (result.paginationOption) {
				return (
					<MenuItem className="default-menu-item rounded !p-0 justify-center gap-1 text-xm" href="javascript:void();" key={index} option={result}>
						<div>Show More</div>
						<ChevronDownCircle className="size-4 stroke-[#aaa]" />
					</MenuItem>
				);
			} else {
				return (
					<MenuItem className="default-menu-item" href="javascript:void();" key={index} option={result}>
						<div>{result.accountName}</div>
					</MenuItem>
				);
			}
		});
		return (
			<Menu className="default-dropdown" {...menuProps}>
				{items}
			</Menu>
		);
	}

	const coverageColumns = [
		{ headerName: 'Name', field: 'name', flex: 1, cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
		{ headerName: 'Role', field: 'role', flex: 1, cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
		{ headerName: 'Coverage Start', field: 'coverageStart', flex: 1, cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
		{ headerName: 'Coverage End', field: 'coverageEnd', flex: 1, cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis' },
		{
			headerName: '30% Payout',
			field: 'payout30',
			flex: 1,
			cellRenderer: (params) => (
				<input
					type="checkbox"
					checked={!!params.value}
					onChange={(e) => {
						params.node.setDataValue('payout30', e.target.checked);
					}}
					style={{ width: 18, height: 18 }}
				/>
			),
			cellClass: 'justify-center',
			minWidth: 60,
			maxWidth: 80,
		},
		{
			headerName: 'Percentage',
			field: 'percentage',
			flex: 1,
			editable: true,
			cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis',
			cellEditor: 'agNumberCellEditor',
			cellEditorParams: {
				min: 0,
				max: 100,
			},
		},
		{
			headerName: 'Action',
			field: 'action',
			flex: 1,
			cellClass: 'justify-center whitespace-nowrap overflow-hidden text-ellipsis',
			minWidth: 100,
			filter: false,
			sortable: false,
			headerClass: 'justify-center-custom',
			lockVisible: true,
			suppressHeaderMenuButton: true,
			maxWidth: 120,
			cellRenderer: function CoverageActionCellRenderer(params) {
				return (
					<div style={{ display: 'flex', gap: '0.5rem', justifyContent: 'center' }}>
						<span style={{ cursor: 'pointer', color: '#999' }} title="Delete" onClick={() => params.context.onDeleteCoverage(params.data)}>
							<Trash2 size={18} strokeWidth={1.5} />
						</span>
					</div>
				);
			},
		},
	];

	function handleEditCoverage(row) {
		setSelectedCoverage({ name: row.name, role: row.role, coverageStart: row.coverageStart, coverageEnd: row.coverageEnd });
		setPercentage(row.percentage.toString());
		setCoverageRows((prev) => prev.filter((r) => r.name !== row.name));
	}

	function handleDeleteCoverage(row) {
		setCoverageRows((prev) => prev.filter((r) => r.name !== row.name));
	}

	function handleAddCoverage() {
		if (!selectedCoverage) {
			setCoverageError('Please select a coverage name.');
			return;
		}
		if (percentage === '' || isNaN(Number(percentage))) {
			setCoverageError('Please enter a valid percentage.');
			return;
		}
		const pct = Math.max(0, Math.min(100, Number(percentage)));
		if (coverageRows.some((row) => row.name === selectedCoverage.name)) {
			setCoverageError('This coverage is already added.');
			return;
		}
		setCoverageRows((prev) => [...prev, { ...selectedCoverage, percentage: pct }]);
		setSelectedCoverage(null);
		setSearch('');
		setPercentage('');
		setCoverageError('');
		setPercentageInputError('');
	}

	const defaultValues = {
		invoiceDate: '',
		invoiceNumber: '',
		accountname: '',
		status: '',
		commission: '',
		includeClientsNotAssigned: false,
		includeDeletedClients: false,
		product: '',
		invoiceFile: null,
		notes: '',
		ticker: '',
		quantity: '',
		price: '',
		netAmount: '',
	};

	const form = useForm({
		mode: 'onChange',
		defaultValues: defaultValues,
	});

	const watchedStatus = form.watch("status");

	useEffect(() => {
		if (editingRow) {
			form.reset({
				accountname: editingRow.accountName || '',
				invoiceDate: editingRow.date,
				invoiceNumber: editingRow.invoice || '',
				status: editingRow.status || '',
				commission: editingRow.commission ? editingRow.commission.replace(/[^\d.]/g, '') : '',
				includeClientsNotAssigned: false,
				includeDeletedClients: false,
				product: editingRow.product || '',
				invoiceFile: editingRow.invoiceFile || null,
				notes: editingRow.notes || '',
				ticker: editingRow.ticker || '',
				quantity: editingRow.quantity || '',
				price: editingRow.price || '',
				netAmount: editingRow.netAmount || '',
			});
			setSelectedAccount(editingRow.accountName ? [{ accountName: editingRow.accountName }] : []);
			setSheetOpen(true);
		}
	}, [editingRow]);

	function cellEditingStopped(e) {
		if (e.colDef.field === 'percentage') {
			let attemptedValue = e.newValue !== undefined ? Number(e.newValue) : Number(e.value);
			if (!isNaN(attemptedValue) && attemptedValue > 100) {
				toast.error('Percentage cannot be more than 100.');
			}
		}
	}

	const sideBar = useMemo(
		() => ({
			toolPanels: [
				{
					id: 'columns',
					labelDefault: 'Columns',
					labelKey: 'columns',
					iconKey: 'columns',
					toolPanel: 'agColumnsToolPanel',
					toolPanelParams: {
						suppressRowGroups: true,
						suppressValues: true,
						suppressPivotMode: true,
						suppressColumnFilter: true,
						suppressColumnSelectAll: true,
						suppressColumnExpandAll: true,
					},
				},
			],
			defaultToolPanel: '',
		}),
		[]
	);

	function ActionCellRenderer(params) {
		const row = params.data;
		return (
			<TooltipProvider>
				<div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
					<Tooltip>
						<TooltipTrigger asChild>
							<button className="text-gray-400" style={{ background: 'none', border: 'none', cursor: 'pointer' }} onClick={() => setEditingRow(row)}>
								<Pencil size={18} />
							</button>
						</TooltipTrigger>
						<TooltipContent>Edit</TooltipContent>
					</Tooltip>
					<span style={{ color: '#d1d5db', fontWeight: 'bold', fontSize: '18px', userSelect: 'none' }}>|</span>
					<Tooltip>
						<TooltipTrigger asChild>
							<button
								className="text-gray-400"
								style={{ background: 'none', border: 'none', cursor: 'pointer' }}
								onClick={() => {
									setRowToDelete(row);
									setShowDeleteDialog(true);
								}}
							>
								<Trash2 size={18} />
							</button>
						</TooltipTrigger>
						<TooltipContent>Delete</TooltipContent>
					</Tooltip>
				</div>
			</TooltipProvider>
		);
	}

	const prevSheetOpenRef = useRef(sheetOpen);
	useEffect(() => {
		if (prevSheetOpenRef.current && !sheetOpen && form.formState.isDirty) {
			setShowUnsavedDialog(true);
			setSheetOpen(true);
		}
		prevSheetOpenRef.current = sheetOpen;
	}, [sheetOpen, form.formState.isDirty]);

	useEffect(() => {
		if (!sheetOpen) {
			form.reset(defaultValues);
			setSelectedAccount([]);
			setCoverageRows([]);
			setEditingRow(null);
		}
	}, [sheetOpen]);

	function handleSheetOpenChange(nextOpen) {
		if (!nextOpen && form.formState.isDirty) {
			setShowUnsavedDialog(true);
			setSheetOpen(true);
		} else {
			setSheetOpen(nextOpen);
		}
	}

	function handleDialogConfirm() {
		setShowUnsavedDialog(false);
		setSheetOpen(false);
		form.reset();
		setEditingRow(null);
	}
	
	function handleDialogCancel() {
		setShowUnsavedDialog(false);
		setSheetOpen(true);
	}

	async function handleDeleteConfirm() {
		setShowDeleteDialog(false);
		if (rowToDelete) {
			try {
				// Call delete API if you have one
				// await httpClient.delete(`/commission/DeleteCommission/${rowToDelete._originalData.id}`);
				
				setRowData((prev) => prev.filter((row) => row !== rowToDelete));
				setRowToDelete(null);
				toast.success('Record deleted successfully');
			} catch (error) {
				console.error('Error deleting record:', error);
				toast.error('Failed to delete record');
			}
		}
	}
	
	function handleDeleteCancel() {
		setShowDeleteDialog(false);
		setRowToDelete(null);
	}

	// Save handler for form - POST to API
	async function handleFormSubmit(data) {
		setIsSaving(true);
		
		try {
			// Prepare payload according to API structure
			const payload = {
				account_id: data.accountname,
				comm_date: data.invoiceDate,
				comm_no: data.invoiceNumber,
				comm_status: data.status,
				commission: data.commission,
				product: data.product,
				ticker: data.ticker || '',
				quantity: data.quantity || '',
				price: data.price || '',
				payOut: false, // Set based on your logic
				net_amount: data.netAmount || '',
				comments: data.notes,
				emp_splits: coverageRows.length > 0 ? JSON.stringify(coverageRows) : '',
			};

			// Make POST request to save commission
			const response = await httpClient.post('/commission/SaveCommission', payload);
			
			if (response.success || response.data) {
				toast.success(editingRow ? 'Invoice updated successfully' : 'Invoice created successfully');
				
				// Refresh data after save
				await fetchInvoiceData();
				
				setSheetOpen(false);
				form.reset();
				setEditingRow(null);
			} else {
				toast.error('Failed to save invoice');
			}
		} catch (error) {
			console.error('Error saving invoice:', error);
			toast.error(error.response?.data?.message || 'Failed to save invoice');
		} finally {
			setIsSaving(false);
		}
	}

	return (
		<div className="w-full">
			<Sheet open={sheetOpen} onOpenChange={handleSheetOpenChange}>
				<SheetContent className="sm:max-w-6xl">
					<SheetHeader>
						<SheetTitle>{editingRow ? 'Edit Invoice' : 'Add Invoice'}</SheetTitle>
					</SheetHeader>
					
					<Dialog open={showUnsavedDialog} onOpenChange={setShowUnsavedDialog}>
						<DialogContent>
							<DialogHeader>
								<DialogTitle>Unsaved Changes</DialogTitle>
							</DialogHeader>
							<div className="mb-6">You have unsaved changes. Are you sure you want to close?</div>
							<DialogFooter className="flex justify-end gap-2">
								<Button variant="outline" onClick={handleDialogCancel}>
									Cancel
								</Button>
								<Button variant="destructive" onClick={handleDialogConfirm}>
									Discard & Close
								</Button>
							</DialogFooter>
						</DialogContent>
					</Dialog>
					
					<Form {...form}>
						<form className="grid grid-cols-3 gap-6 p-4" onSubmit={form.handleSubmit(handleFormSubmit)}>
							<div>
								<FormField
									control={form.control}
									name="accountname"
									rules={{ required: 'Account Name is required' }}
									render={({ field }) => (
										<FormItem>
											<FormLabel className="font-medium">Account Name<span className="text-red-500">*</span></FormLabel>
											<div style={{ position: 'relative' }}>
												<AsyncTypeahead
													id="account-typeahead"
													labelKey="accountName"
													options={accountOptions}
													minLength={1}
													placeholder="Search Account Name"
													onSearch={handleAccountSearch}
													onChange={handleAccountChange}
													selected={selectedAccount}
													inputProps={{
														className: 'h-11 w-full border rounded-md px-3 py-2 text-base focus:outline-none focus:ring-1 placeholder:text-gray-400',
														required: true,
													}}
													menuStyle={{
														zIndex: 1050,
														width: '100%',
														position: 'absolute',
													}}
													renderMenu={renderAccountMenu}
												/>
											</div>
											<FormMessage />
										</FormItem>
									)}
								/>
							</div>
							
							<div>
								<FormField
									control={form.control}
									name="invoiceDate"
									rules={{ required: 'Invoice Date is required' }}
									render={({ field }) => (
										<FormItem>
											<FormLabel className="font-medium">Invoice Date<span className="text-red-500">*</span></FormLabel>
											<Popover>
												<PopoverTrigger asChild>
													<Button
														variant="outline"
														className={'w-full justify-start text-left font-normal h-11' + (field.value ? '' : ' text-muted-foreground')}
													>
														<CalendarIcon className="mr-2 h-4 w-4" />
														{field.value ? field.value : <span>Pick a date</span>}
													</Button>
												</PopoverTrigger>
												<PopoverContent className="w-auto p-0">
													<Calendar
														mode="single"
														selected={field.value ? new Date(field.value) : undefined}
														onSelect={(date) => field.onChange(date ? date.toISOString().slice(0, 10) : '')}
														initialFocus
													/>
												</PopoverContent>
											</Popover>
											<FormMessage />
										</FormItem>
									)}
								/>
							</div>

							<div>
								<FormField
									control={form.control}
									name="invoiceNumber"
									rules={{ required: 'Invoice Number is required' }}
									render={({ field }) => (
										<FormItem>
											<FormLabel className="font-medium">Invoice Number<span className="text-red-500">*</span></FormLabel>
											<Input
												{...field}
												type="text"
												maxLength={256}
												className="focus:outline-none focus:ring-2 focus:ring-primary h-11"
												placeholder="Enter invoice number"
												required
											/>
											<FormMessage />
										</FormItem>
									)}
								/>
							</div>
							
							<div>
								<FormField
									control={form.control}
									name="status"
									rules={{ required: 'Invoice Status is required' }}
									render={({ field }) => (
										<FormItem>
											<FormLabel className="font-medium">Invoice Status<span className="text-red-500">*</span></FormLabel>
											<Select value={field.value} onValueChange={field.onChange} disabled={field.disabled} required>
												<SelectTrigger className="w-full justify-between h-11">
													<SelectValue placeholder="Select status" />
												</SelectTrigger>
												<SelectContent>
													<SelectItem value="Open">Open</SelectItem>
													<SelectItem value="Paid">Paid</SelectItem>
												</SelectContent>
											</Select>
											<FormMessage />
										</FormItem>
									)}
								/>
							</div>

							<div>
								<FormField
									control={form.control}
									name="commission"
									rules={{ required: 'Commission is required' }}
									render={({ field }) => (
										<FormItem>
											<FormLabel className="font-medium">Commission<span className="text-red-500">*</span></FormLabel>
											<Input
												{...field}
												type="number"
												step="any"
												className="w-full focus:outline-none focus:ring-2 focus:ring-primary h-11"
												placeholder="Enter commission amount"
												required
											/>
											<FormMessage />
										</FormItem>
									)}
								/>
							</div>

							<div className="flex flex-col gap-2 justify-end">
								<FormField
									control={form.control}
									name="includeClientsNotAssigned"
