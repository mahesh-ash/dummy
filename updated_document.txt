# Implementation Guide - Enhanced Enterprise Portal

## üìÅ File Structure

```
src/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ header.json
‚îÇ   ‚îú‚îÄ‚îÄ menu.json
‚îÇ   ‚îú‚îÄ‚îÄ pages.json
‚îÇ   ‚îú‚îÄ‚îÄ constantsConfig.js
‚îÇ   ‚îú‚îÄ‚îÄ formSettingsConfig.js
‚îÇ   ‚îú‚îÄ‚îÄ tableSettingsConfig.js
‚îÇ   ‚îú‚îÄ‚îÄ userManagementConfig.js (NEW)
‚îÇ   ‚îî‚îÄ‚îÄ loginConfig.js (NEW)
‚îÇ
‚îú‚îÄ‚îÄ store/
‚îÇ   ‚îú‚îÄ‚îÄ configStore.js (UPDATED)
‚îÇ   ‚îî‚îÄ‚îÄ authStore.js (NEW)
‚îÇ
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ConfigManager.jsx (ENHANCED)
‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.jsx (ENHANCED)
‚îÇ   ‚îú‚îÄ‚îÄ Header.jsx
‚îÇ   ‚îú‚îÄ‚îÄ Router.jsx (UPDATED)
‚îÇ   ‚îú‚îÄ‚îÄ PrivateRoute.jsx (NEW)
‚îÇ   ‚îî‚îÄ‚îÄ ui/ (shadcn components)
‚îÇ
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ Home.jsx
‚îÇ   ‚îú‚îÄ‚îÄ UserManagement.jsx (UPDATED)
‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx (NEW)
‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ       ‚îú‚îÄ‚îÄ Constants.jsx
‚îÇ       ‚îú‚îÄ‚îÄ FormSettings.jsx
‚îÇ       ‚îî‚îÄ‚îÄ TableSettings.jsx
‚îÇ
‚îú‚îÄ‚îÄ registry/
‚îÇ   ‚îî‚îÄ‚îÄ componentRegistry.js (UPDATED)
‚îÇ
‚îú‚îÄ‚îÄ App.jsx (UPDATED)
‚îî‚îÄ‚îÄ main.jsx
```

## üöÄ New Features Implemented

### 1. **User Management Module**
- Dynamic user form with validation
- AG Grid integration for user listing
- Fields: Name, Email, Phone, Role, Department, Status
- Real-time validation with proper error messages

### 2. **Authentication System**
- Dynamic login form from JSON config
- Static credentials: `mahesh / mahesh@123`
- localStorage persistence
- Automatic redirect on logout

### 3. **Private Routing**
- Protected routes requiring authentication
- Automatic redirect to login for unauthenticated users
- Login page redirect to home if already authenticated

### 4. **Enhanced UI/UX**
- Modern gradient designs
- Better color schemes and shadows
- Responsive layouts for all screen sizes
- Improved sidebar with user info and logout
- Better AG Grid styling

### 5. **Form Improvements**
- Cancel confirmation dialog with unsaved changes
- Delete confirmation with descriptive messages
- Fixed label color issue (labels now stay gray-700 unless error)
- Better form validation feedback
- Loading states on submit buttons

## üîß Installation Steps

### 1. Install Required Dependencies
```bash
npm install @preact/signals-react
npm install lucide-react
npm install sonner
npm install react-hook-form
npm install ag-grid-react ag-grid-community ag-grid-enterprise
```

### 2. Create New Files

#### **userManagementConfig.js**
Place in `src/config/userManagementConfig.js` (provided above)

#### **loginConfig.js**
Place in `src/config/loginConfig.js` (provided above)

#### **authStore.js**
Place in `src/store/authStore.js` (provided above)

#### **Login.jsx**
Place in `src/pages/Login.jsx` (provided above)

#### **PrivateRoute.jsx**
Place in `src/components/PrivateRoute.jsx` (provided above)

### 3. Update Existing Files

#### **UserManagement.jsx**
Replace `src/pages/UserManagement.jsx` with updated version

#### **ConfigManager.jsx**
Replace `src/components/ConfigManager.jsx` with enhanced version

#### **Sidebar.jsx**
Replace `src/components/Sidebar.jsx` with enhanced version

#### **Router.jsx**
Replace `src/components/Router.jsx` with updated version

#### **App.jsx**
Replace `src/App.jsx` with updated version

#### **configStore.js**
Replace `src/store/configStore.js` with updated version

#### **componentRegistry.js**
Replace `src/registry/componentRegistry.js` with updated version

## üé® Key Improvements Explained

### Label Color Fix
The issue where labels changed color on error was fixed by using `fieldState.error` check:

```jsx
<FormLabel className={`gap-1 font-medium text-sm ${fieldState.error ? '' : 'text-gray-700 dark:text-gray-200'}`}>
```

Now labels maintain their gray color and only the FormMessage shows red error text.

### Cancel Confirmation
Tracks form dirty state and shows confirmation dialog:

```jsx
const [formDirty, setFormDirty] = useState(false);

// Track changes
React.useEffect(() => {
  const subscription = form.watch(() => {
    setFormDirty(true);
  });
  return () => subscription.unsubscribe();
}, [form]);
```

### Delete Confirmation
Enhanced with descriptive DialogDescription:

```jsx
<DialogDescription>
  Are you sure you want to delete this {entityName}? 
  This action cannot be undone and all data will be permanently removed.
</DialogDescription>
```

### Authentication Flow
1. User visits protected route ‚Üí Redirected to login
2. User logs in ‚Üí Redirected to home page
3. User data persists in localStorage
4. Logout clears auth state and redirects to login

## üîê Login Credentials

**Username:** mahesh  
**Password:** mahesh@123

## üì± Responsive Design

- **Mobile (< 1024px)**: 
  - Collapsible sidebar with overlay
  - Stacked form layouts
  - Touch-friendly buttons

- **Desktop (‚â• 1024px)**:
  - Expandable/collapsible sidebar
  - Side-by-side form layouts
  - Hover effects

## üéØ Testing Checklist

- [ ] Login with correct credentials
- [ ] Login with wrong credentials (should show error)
- [ ] Try accessing pages without login (should redirect to login)
- [ ] Add new user in User Management
- [ ] Edit existing user
- [ ] Try closing form with unsaved changes (should show confirmation)
- [ ] Delete user (should show confirmation)
- [ ] Test all Config Master pages (Constants, Form Settings, Table Settings)
- [ ] Test responsive design on mobile
- [ ] Test logout functionality
- [ ] Test browser back/forward buttons

## üõ†Ô∏è Troubleshooting

### Issue: Login page not showing
**Solution:** Check that componentRegistry.js includes Login component

### Issue: Routes not protected
**Solution:** Verify PrivateRoute component is wrapping protected routes in Router.jsx

### Issue: Sidebar not showing after login
**Solution:** Check that App.jsx conditionally renders Sidebar based on authentication

### Issue: Form label colors still changing
**Solution:** Make sure you're using the updated ConfigManager.jsx with fieldState.error check

## üìù Additional Notes

- All form configurations are in separate config files for easy maintenance
- Authentication state persists across page refreshes using localStorage
- The system is fully dynamic - add new config files to extend functionality
- AG Grid is licensed for enterprise features (columns panel, set filter)

## üéâ Success!

You now have a fully functional enterprise portal with:
- ‚úÖ User Management with dynamic forms
- ‚úÖ Secure authentication system
- ‚úÖ Private routing
- ‚úÖ Enhanced UI/UX
- ‚úÖ Form validations with confirmations
- ‚úÖ Responsive design

Happy coding! üöÄ
-----------------------------------------------------------------
// src/config/userManagementConfig.js
export const userManagementConfig = {
	pageTitle: 'User Management',
	entityName: 'user',
	primaryField: 'name',
	valueField: null,
	
	fieldConfig: [
		{
			name: 'name',
			label: 'Full Name',
			placeholder: 'Enter full name',
			type: 'text',
			mandatory: true,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: /^[a-zA-Z\s]{2,50}$/,
			patternMessage: 'Name should contain only letters and spaces (2-50 characters)',
			defaultValue: '',
			className: '',
			maxLength: 50,
			order: 1,
		},
		{
			name: 'email',
			label: 'Email Address',
			placeholder: 'Enter email address',
			type: 'email',
			mandatory: true,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,
			patternMessage: 'Please enter a valid email address',
			defaultValue: '',
			className: '',
			maxLength: 100,
			order: 2,
		},
		{
			name: 'phone',
			label: 'Phone Number',
			placeholder: 'Enter phone number',
			type: 'text',
			mandatory: false,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: /^[0-9]{10}$/,
			patternMessage: 'Phone number must be 10 digits',
			defaultValue: '',
			className: '',
			maxLength: 10,
			order: 3,
		},
		{
			name: 'role',
			label: 'Role',
			placeholder: 'Select role',
			type: 'select',
			mandatory: true,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: null,
			patternMessage: '',
			defaultValue: 'User',
			className: '',
			options: [
				{ label: 'Admin', value: 'Admin' },
				{ label: 'Manager', value: 'Manager' },
				{ label: 'User', value: 'User' },
				{ label: 'Viewer', value: 'Viewer' },
			],
			order: 4,
		},
		{
			name: 'department',
			label: 'Department',
			placeholder: 'Enter department',
			type: 'text',
			mandatory: false,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: null,
			patternMessage: '',
			defaultValue: '',
			className: '',
			maxLength: 50,
			order: 5,
		},
		{
			name: 'status',
			label: 'Status',
			placeholder: 'Select status',
			type: 'select',
			mandatory: true,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: null,
			patternMessage: '',
			defaultValue: 'Active',
			className: '',
			options: [
				{ label: 'Active', value: 'Active' },
				{ label: 'Inactive', value: 'Inactive' },
			],
			order: 6,
		},
	],
	
	columnConfig: [
		{
			headerName: 'Name',
			field: 'name',
			sortable: true,
			filter: 'agTextColumnFilter',
			floatingFilter: true,
			flex: 1,
			minWidth: 150,
			cellClass: 'font-medium',
		},
		{
			headerName: 'Email',
			field: 'email',
			sortable: true,
			filter: 'agTextColumnFilter',
			floatingFilter: true,
			flex: 1.5,
			minWidth: 200,
		},
		{
			headerName: 'Phone',
			field: 'phone',
			sortable: true,
			filter: 'agTextColumnFilter',
			floatingFilter: true,
			width: 130,
			cellRenderer: 'default',
		},
		{
			headerName: 'Role',
			field: 'role',
			sortable: true,
			filter: 'agSetColumnFilter',
			floatingFilter: true,
			width: 120,
			cellClass: 'text-center',
		},
		{
			headerName: 'Department',
			field: 'department',
			sortable: true,
			filter: 'agTextColumnFilter',
			floatingFilter: true,
			flex: 1,
			minWidth: 130,
			cellRenderer: 'default',
		},
		{
			headerName: 'Status',
			field: 'status',
			sortable: true,
			filter: 'agSetColumnFilter',
			floatingFilter: true,
			width: 120,
			cellRenderer: 'status',
		},
		{
			headerName: 'Last Modified',
			field: 'last_modified',
			sortable: true,
			filter: 'agDateColumnFilter',
			floatingFilter: true,
			width: 180,
			cellRenderer: 'date',
		},
	],
};
------------------------------------------------------------------------
// src/config/loginConfig.js
export const loginConfig = {
	pageTitle: 'Login',
	formTitle: 'Welcome Back',
	formSubtitle: 'Please login to continue',
	
	fieldConfig: [
		{
			name: 'username',
			label: 'Username',
			placeholder: 'Enter your username',
			type: 'text',
			mandatory: true,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: /^[a-zA-Z0-9_]{3,20}$/,
			patternMessage: 'Username must be 3-20 characters (letters, numbers, underscore)',
			defaultValue: '',
			className: '',
			maxLength: 20,
			order: 1,
			autoComplete: 'username',
		},
		{
			name: 'password',
			label: 'Password',
			placeholder: 'Enter your password',
			type: 'password',
			mandatory: true,
			disabled: false,
			hidden: false,
			readOnly: false,
			pattern: null,
			patternMessage: '',
			defaultValue: '',
			className: '',
			maxLength: 50,
			order: 2,
			autoComplete: 'current-password',
		},
	],
	
	// Static credentials (in production, this would be API-based)
	staticCredentials: {
		username: 'mahesh',
		password: 'mahesh@123',
	},
};
----------------------------------------------------------------------------------------------------------------
// src/store/authStore.js
import { signal } from '@preact/signals-react';

// Check if user is already logged in from localStorage
const storedAuth = typeof window !== 'undefined' ? localStorage.getItem('isAuthenticated') : null;
const storedUser = typeof window !== 'undefined' ? localStorage.getItem('currentUser') : null;

export const isAuthenticated = signal(storedAuth === 'true');
export const currentUser = signal(storedUser ? JSON.parse(storedUser) : null);

export const login = (username) => {
	isAuthenticated.value = true;
	currentUser.value = { username };
	
	// Persist to localStorage
	if (typeof window !== 'undefined') {
		localStorage.setItem('isAuthenticated', 'true');
		localStorage.setItem('currentUser', JSON.stringify({ username }));
	}
};

export const logout = () => {
	isAuthenticated.value = false;
	currentUser.value = null;
	
	// Clear localStorage
	if (typeof window !== 'undefined') {
		localStorage.removeItem('isAuthenticated');
		localStorage.removeItem('currentUser');
	}
};
------------------------------------------------------------
// src/pages/Login.jsx
import React, { useState } from 'react';
import { useForm } from 'react-hook-form';
import { Button } from '@/components/ui/button';
import { Form, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import { loginConfig } from '@/config/loginConfig';
import { login } from '@/store/authStore';
import { navigateTo } from '@/store/configStore';
import { toast } from 'sonner';
import { Eye, EyeOff, Lock, User } from 'lucide-react';

export default function Login() {
	const [showPassword, setShowPassword] = useState(false);
	const [isLoading, setIsLoading] = useState(false);

	const defaultValues = loginConfig.fieldConfig.reduce((acc, field) => {
		acc[field.name] = field.defaultValue;
		return acc;
	}, {});

	const form = useForm({
		mode: 'onChange',
		defaultValues,
	});

	const handleSubmit = async (data) => {
		setIsLoading(true);
		
		// Simulate API call delay
		await new Promise(resolve => setTimeout(resolve, 800));

		const { username, password } = data;
		const { staticCredentials } = loginConfig;

		if (username === staticCredentials.username && password === staticCredentials.password) {
			login(username);
			toast.success('Login successful!');
			navigateTo('/');
		} else {
			toast.error('Invalid username or password');
		}
		
		setIsLoading(false);
	};

	const renderFormField = (fieldConfig) => {
		const rules = {
			required: fieldConfig.mandatory ? `${fieldConfig.label} is required` : false,
			pattern: fieldConfig.pattern
				? {
						value: fieldConfig.pattern,
						message: fieldConfig.patternMessage || `Invalid ${fieldConfig.label} format`,
				  }
				: undefined,
		};

		if (fieldConfig.type === 'password') {
			return (
				<FormField
					key={fieldConfig.name}
					control={form.control}
					name={fieldConfig.name}
					rules={rules}
					render={({ field }) => (
						<FormItem className="w-full">
							<FormLabel className="font-medium text-sm text-gray-700 dark:text-gray-200">
								{fieldConfig.label}
								{fieldConfig.mandatory && <span className="text-red-500 ml-1">*</span>}
							</FormLabel>
							<div className="relative">
								<Lock className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
								<Input
									{...field}
									type={showPassword ? 'text' : 'password'}
									autoComplete={fieldConfig.autoComplete}
									className="h-12 pl-10 pr-12 border-gray-300 focus:border-blue-500 focus:ring-blue-500"
									placeholder={fieldConfig.placeholder}
								/>
								<button
									type="button"
									onClick={() => setShowPassword(!showPassword)}
									className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
								>
									{showPassword ? <EyeOff className="h-5 w-5" /> : <Eye className="h-5 w-5" />}
								</button>
							</div>
							<div className="min-h-[20px]">
								<FormMessage />
							</div>
						</FormItem>
					)}
				/>
			);
		}

		return (
			<FormField
				key={fieldConfig.name}
				control={form.control}
				name={fieldConfig.name}
				rules={rules}
				render={({ field }) => (
					<FormItem className="w-full">
						<FormLabel className="font-medium text-sm text-gray-700 dark:text-gray-200">
							{fieldConfig.label}
							{fieldConfig.mandatory && <span className="text-red-500 ml-1">*</span>}
						</FormLabel>
						<div className="relative">
							<User className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
							<Input
								{...field}
								type={fieldConfig.type}
								autoComplete={fieldConfig.autoComplete}
								maxLength={fieldConfig.maxLength}
								className="h-12 pl-10 border-gray-300 focus:border-blue-500 focus:ring-blue-500"
								placeholder={fieldConfig.placeholder}
							/>
						</div>
						<div className="min-h-[20px]">
							<FormMessage />
						</div>
					</FormItem>
				)}
			/>
		);
	};

	return (
		<div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-purple-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-4">
			<div className="w-full max-w-md">
				{/* Card */}
				<div className="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
					{/* Header */}
					<div className="bg-gradient-to-r from-blue-600 to-purple-600 p-8 text-white">
						<div className="flex items-center justify-center mb-4">
							<div className="w-16 h-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center">
								<Lock className="h-8 w-8" />
							</div>
						</div>
						<h1 className="text-3xl font-bold text-center">{loginConfig.formTitle}</h1>
						<p className="text-blue-100 text-center mt-2">{loginConfig.formSubtitle}</p>
					</div>

					{/* Form */}
					<div className="p-8">
						<Form {...form}>
							<form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-6">
								{loginConfig.fieldConfig
									.sort((a, b) => a.order - b.order)
									.map((field) => renderFormField(field))}

								<Button
									type="submit"
									disabled={!form.formState.isValid || isLoading}
									className="w-full h-12 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-semibold text-base shadow-lg hover:shadow-xl transition-all duration-200"
								>
									{isLoading ? (
										<div className="flex items-center gap-2">
											<div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
											<span>Logging in...</span>
										</div>
									) : (
										'Login'
									)}
								</Button>
							</form>
						</Form>

						{/* Demo Credentials */}
						<div className="mt-6 p-4 bg-blue-50 dark:bg-gray-700 rounded-lg border border-blue-200 dark:border-gray-600">
							<p className="text-xs text-gray-600 dark:text-gray-300 font-medium mb-2">Demo Credentials:</p>
							<div className="text-xs text-gray-700 dark:text-gray-200 space-y-1">
								<p><span className="font-semibold">Username:</span> mahesh</p>
								<p><span className="font-semibold">Password:</span> mahesh@123</p>
							</div>
						</div>
					</div>
				</div>

				{/* Footer */}
				<div className="text-center mt-6 text-sm text-gray-600 dark:text-gray-400">
					<p>¬© 2025 PrismIQ. All rights reserved.</p>
				</div>
			</div>
		</div>
	);
}
----------------------------------------------------------------------------
// src/components/PrivateRoute.jsx
import React, { useEffect } from 'react';
import { isAuthenticated } from '@/store/authStore';
import { navigateTo } from '@/store/configStore';
import { useSignals } from '@preact/signals-react/runtime';

export default function PrivateRoute({ children }) {
	useSignals();
	const authenticated = isAuthenticated.value;

	useEffect(() => {
		if (!authenticated) {
			navigateTo('/login');
		}
	}, [authenticated]);

	if (!authenticated) {
		return (
			<div className="flex items-center justify-center min-h-screen">
				<div className="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin" />
			</div>
		);
	}

	return children;
}
---------------------------------------
// src/components/Router.jsx - Updated with private routing
import React, { Suspense, useEffect, useState } from 'react';
import { allRoutes, currentRoute, navigateTo } from '@/store/configStore';
import { pageRegistry } from '@/registry/componentRegistry';
import { isAuthenticated } from '@/store/authStore';
import PrivateRoute from './PrivateRoute';

export default function Router() {
	const [activePath, setActivePath] = useState(currentRoute.value);
	const [authenticated, setAuthenticated] = useState(isAuthenticated.value);

	useEffect(() => {
		const unsubscribeRoute = currentRoute.subscribe((val) => {
			setActivePath(val);
		});

		const unsubscribeAuth = isAuthenticated.subscribe((val) => {
			setAuthenticated(val);
		});

		return () => {
			unsubscribeRoute();
			unsubscribeAuth();
		};
	}, []);

	const routes = allRoutes.value;
	const route = routes.find((r) => r.path === activePath);

	// Public routes that don't require authentication
	const publicRoutes = ['/login'];
	const isPublicRoute = publicRoutes.includes(activePath);

	// Get component from registry
	const Component = route ? pageRegistry[route.component] : null;

	// Redirect to home if authenticated user tries to access login
	useEffect(() => {
		if (authenticated && activePath === '/login') {
			navigateTo('/');
		}
	}, [authenticated, activePath]);

	if (Component) {
		return (
			<Suspense
				key={activePath}
				fallback={
					<div className="flex items-center justify-center min-h-[400px] sm:min-h-screen">
						<div className="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin" />
					</div>
				}
			>
				{isPublicRoute ? (
					<Component />
				) : (
					<PrivateRoute>
						<Component />
					</PrivateRoute>
				)}
			</Suspense>
		);
	}

	return (
		<div className="p-4 sm:p-6 text-center">
			<h1 className="text-xl font-bold">404 - Page Not Found</h1>
			<p>The route "{activePath}" does not exist.</p>
			<button
				onClick={() => navigateTo('/')}
				className="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
			>
				Go Home
			</button>
		</div>
	);
}
-------------------------------------------------------
// src/components/ConfigManager.jsx - Enhanced with better UI and confirmations
import React, { useRef, useState, useMemo } from 'react';
import { AgGridReact } from "ag-grid-react";
import { Pencil, Trash2, Plus, Download, Upload, History, RotateCcw, GitCompare, RefreshCcw, X } from 'lucide-react';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';
import { Sheet, SheetContent, SheetHeader, SheetTitle, SheetFooter } from '@/components/ui/sheet';
import { Button } from '@/components/ui/button';
import { Form, FormField, FormItem, FormLabel, FormMessage } from '@/components/ui/form';
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from '@/components/ui/select';
import { useForm } from 'react-hook-form';
import { Input } from '@/components/ui/input';
import { toast } from 'sonner';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter, DialogDescription } from '@/components/ui/dialog';
import { useSignals } from '@preact/signals-react/runtime';
import { Textarea } from '@/components/ui/textarea';
import {
	DropdownMenu,
	DropdownMenuContent,
	DropdownMenuItem,
	DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { 
  ModuleRegistry,
  ColumnsToolPanelModule, 
  SetFilterModule, 
  ColumnMenuModule, 
  ContextMenuModule 
} from 'ag-grid-enterprise';

ModuleRegistry.registerModules([
  ColumnsToolPanelModule,
  SetFilterModule,
  ColumnMenuModule,
  ContextMenuModule
]);

const defaultColDef = {
	sortable: true,
	editable: false,
	flex: 1,
	filter: 'agTextColumnFilter',
	floatingFilter: true,
	cellStyle: {
		whiteSpace: 'nowrap',
		overflow: 'hidden',
		textOverflow: 'ellipsis',
	},
};

// Cell Renderers
function StatusCellRenderer(props) {
	const isActive = props.value === 'Active';
	return (
		<div className="flex items-center justify-center h-full">
			<span
				className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold shadow-sm ${
					isActive
						? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
						: 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200'
				}`}
			>
				{props.value}
			</span>
		</div>
	);
}

function DateCellRenderer(props) {
	if (!props.value) return <div className="text-gray-400">-</div>;
	const date = new Date(props.value);
	return (
		<div title={props.value} className="text-gray-700 dark:text-gray-300">
			{date.toLocaleString('en-US', {
				year: 'numeric',
				month: 'short',
				day: 'numeric',
				hour: '2-digit',
				minute: '2-digit',
			})}
		</div>
	);
}

function DefaultCellRenderer(props) {
	return (
		<div title={props.value} className="text-gray-700 dark:text-gray-300">
			{props.value == 'null' || props.value == null || !props.value ? '-' : props.value}
		</div>
	);
}

export default function ConfigManager({ config }) {
	useSignals();
	const gridRef = useRef();

	const {
		pageTitle,
		entityName,
		fieldConfig,
		columnConfig,
		primaryField,
		valueField,
	} = config;

	const [tableData, setTableData] = useState([]);
	const [showDeleteDialog, setShowDeleteDialog] = useState(false);
	const [showCancelDialog, setShowCancelDialog] = useState(false);
	const [rowToDelete, setRowToDelete] = useState(null);
	const [showCompareDialog, setShowCompareDialog] = useState(false);
	const [compareData, setCompareData] = useState({ original: null, modified: null });
	const [excelLoading, setExcelLoading] = useState(false);
	const [lastRefresh, setLastRefresh] = useState(null);
	const [editingRow, setEditingRow] = useState(null);
	const [showFormSheet, setShowFormSheet] = useState(false);
	const [formDirty, setFormDirty] = useState(false);

	const sortedFields = useMemo(() => {
		return [...fieldConfig].sort((a, b) => a.order - b.order);
	}, [fieldConfig]);

	const defaultValues = useMemo(() => {
		return fieldConfig.reduce((acc, field) => {
			acc[field.name] = field.defaultValue;
			return acc;
		}, {});
	}, [fieldConfig]);

	const form = useForm({
		mode: 'onChange',
		defaultValues,
	});

	// Track form changes
	React.useEffect(() => {
		const subscription = form.watch(() => {
			setFormDirty(true);
		});
		return () => subscription.unsubscribe();
	}, [form]);

	const validateJSON = (value) => {
		if (!value) return true;
		try {
			JSON.parse(value);
			return true;
		} catch (e) {
			return 'Invalid JSON format';
		}
	};

    const cellRendererMap = {
		status: StatusCellRenderer,
		date: DateCellRenderer,
		default: DefaultCellRenderer,
		truncate: (params) => (
			<div className="truncate" title={params.value}>
				{params.value}
			</div>
		),
	};

	function ActionCellRenderer(params) {
		const row = params.data;
		return (
			<div className="flex items-center justify-center h-full">
				<DropdownMenu>
					<DropdownMenuTrigger asChild>
						<Button variant="ghost" size="sm" className="h-8 px-3 text-xs font-medium hover:bg-blue-50 dark:hover:bg-blue-900">
							Action
						</Button>
					</DropdownMenuTrigger>
					<DropdownMenuContent align="end" className="w-36">
						<DropdownMenuItem onClick={() => handleEdit(row)} className="cursor-pointer">
							<Pencil className="mr-2 h-4 w-4" />
							Edit
						</DropdownMenuItem>
						<DropdownMenuItem onClick={() => handleDelete(row)} className="cursor-pointer text-red-600">
							<Trash2 className="mr-2 h-4 w-4" />
							Delete
						</DropdownMenuItem>
						<DropdownMenuItem onClick={() => handleHistory(row)} className="cursor-pointer">
							<History className="mr-2 h-4 w-4" />
							History
						</DropdownMenuItem>
					</DropdownMenuContent>
				</DropdownMenu>
			</div>
		);
	}

	const columnDefs = useMemo(() => {
		const columns = columnConfig.map(col => {
			const baseCol = {
				headerName: col.headerName,
				field: col.field,
				sortable: col.sortable !== false,
				filter: col.filter || 'agTextColumnFilter',
				floatingFilter: col.floatingFilter !== false,
				...col,
			};

			if (typeof col.cellRenderer === 'string') {
				baseCol.cellRenderer = cellRendererMap[col.cellRenderer];
			}

			return baseCol;
		});

		columns.push({
			headerName: 'Action',
			field: 'action',
			width: 120,
			pinned: 'right',
			cellRenderer: ActionCellRenderer,
			sortable: false,
			filter: false,
			floatingFilter: false,
		});

		return columns;
	}, [columnConfig]);

	const sideBar = useMemo(
		() => ({
			toolPanels: [
				{
					id: 'columns',
					labelDefault: 'Columns',
					labelKey: 'columns',
					iconKey: 'columns',
					toolPanel: 'agColumnsToolPanel',
					toolPanelParams: {
						suppressRowGroups: true,
						suppressValues: true,
						suppressPivotMode: true,
						suppressColumnFilter: true,
						suppressColumnSelectAll: true,
						suppressColumnExpandAll: true,
					},
				},
			],
			defaultToolPanel: '',
		}),
		[]
	);

	const handleAddNew = () => {
		setEditingRow(null);
		form.reset(defaultValues);
		setFormDirty(false);
		setShowFormSheet(true);
	};

	const handleEdit = (data) => {
		setEditingRow(data);
		form.reset(data);
		setFormDirty(false);
		setShowFormSheet(true);
		toast.info(`Editing ${entityName}`);
	};

	const handleCloseSheet = () => {
		if (formDirty) {
			setShowCancelDialog(true);
		} else {
			setShowFormSheet(false);
			form.reset(defaultValues);
			setEditingRow(null);
			setFormDirty(false);
		}
	};

	const handleCancelConfirm = () => {
		setShowCancelDialog(false);
		setShowFormSheet(false);
		form.reset(defaultValues);
		setEditingRow(null);
		setFormDirty(false);
		toast.info('Changes discarded');
	};

	const handleDelete = (row) => {
		setRowToDelete(row);
		setShowDeleteDialog(true);
	};

	const handleDeleteConfirm = () => {
		if (rowToDelete) {
			setTableData((prev) => prev.filter((row) => row.id !== rowToDelete.id));
			toast.success(`${entityName} deleted successfully`);
			setShowDeleteDialog(false);
			setRowToDelete(null);
		}
	};

	const handleDeleteCancel = () => {
		setShowDeleteDialog(false);
		setRowToDelete(null);
	};

	const handleHistory = (data) => {
		toast.info(`Viewing history for: ${data[primaryField]}`);
	};

	const handleFormSubmit = (data) => {
		try {
			if (valueField && data[valueField]) {
				JSON.parse(data[valueField]);
			}

			const timestamp = new Date().toISOString();

			if (editingRow) {
				setTableData((prev) =>
					prev.map((row) =>
						row.id === editingRow.id
							? {
									...data,
									id: row.id,
									last_modified: timestamp,
									created_at: row.created_at,
							  }
							: row
					)
				);
				toast.success(`${entityName} updated successfully`);
				setEditingRow(null);
			} else {
				const newRow = {
					...data,
					id: Date.now(),
					created_at: timestamp,
					last_modified: timestamp,
				};
				setTableData((prev) => [...prev, newRow]);
				toast.success(`${entityName} added successfully`);
			}

			form.reset(defaultValues);
			setShowFormSheet(false);
			setFormDirty(false);
		} catch (error) {
			toast.error(`Invalid JSON format in ${valueField}`);
		}
	};

	const handleReset = () => {
		form.reset(editingRow || defaultValues);
		setFormDirty(false);
		toast.info('Form reset successfully');
	};

	const handleCompareJSON = () => {
		const currentData = form.getValues();
		if (editingRow) {
			setCompareData({
				original: editingRow,
				modified: currentData,
			});
			setShowCompareDialog(true);
		} else {
			toast.warning(`Please edit a ${entityName} to compare`);
		}
	};

	const handleRefresh = () => {
		setLastRefresh(new Date());
		gridRef.current?.api?.refreshCells({ force: true });
		toast.success('Table refreshed');
	};

	const handleExport = () => {
		try {
			setExcelLoading(true);
			const dataStr = JSON.stringify(tableData, null, 2);
			const dataBlob = new Blob([dataStr], { type: 'application/json' });
			const url = URL.createObjectURL(dataBlob);
			const link = document.createElement('a');
			link.href = url;
			link.download = `${entityName.replace(/\s+/g, '_')}_${new Date().toISOString().slice(0, 10)}.json`;
			document.body.appendChild(link);
			link.click();
			link.remove();
			URL.revokeObjectURL(url);
			toast.success(`${entityName}s exported successfully`);
		} catch (error) {
			toast.error('Export failed');
		} finally {
			setExcelLoading(false);
		}
	};

	const handleImport = (event) => {
		const file = event.target.files?.[0];
		if (!file) return;

		const reader = new FileReader();
		reader.onload = (e) => {
			try {
				const imported = JSON.parse(e.target.result);
				if (Array.isArray(imported)) {
					setTableData(imported);
					toast.success(`${entityName}s imported successfully`);
				} else {
					toast.error('Invalid JSON format');
				}
			} catch (error) {
				toast.error('Failed to parse JSON file');
			}
		};
		reader.readAsText(file);
		event.target.value = '';
	};

	const renderFormField = (fieldConfig) => {
		if (fieldConfig.hidden) return null;

		const rules = {
			required: fieldConfig.mandatory ? `${fieldConfig.label} is required` : false,
			pattern: fieldConfig.pattern
				? {
						value: fieldConfig.pattern,
						message: fieldConfig.patternMessage || `Invalid ${fieldConfig.label} format`,
				  }
				: undefined,
			validate: fieldConfig.name === valueField ? validateJSON : undefined,
		};

		switch (fieldConfig.type) {
			case 'textarea':
				return (
					<FormField
						key={fieldConfig.name}
						control={form.control}
						name={fieldConfig.name}
						rules={rules}
						render={({ field, fieldState }) => (
							<FormItem className="w-full">
								<FormLabel className={`gap-1 font-medium text-sm ${fieldState.error ? '' : 'text-gray-700 dark:text-gray-200'}`}>
									{fieldConfig.label}
									{fieldConfig.mandatory && <span className="text-red-500 ml-1">*</span>}
								</FormLabel>
								<div>
									<Textarea
										{...field}
										disabled={fieldConfig.disabled || fieldConfig.readOnly}
										className={`shadow-none ${fieldConfig.isJSON ? 'h-[200px]' : 'h-[120px]'} resize-none disabled:bg-gray-100 dark:disabled:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-100`}
										placeholder={fieldConfig.placeholder}
										required={fieldConfig.mandatory}
									/>
									<div className="min-h-[20px]">
										<FormMessage />
									</div>
								</div>
							</FormItem>
						)}
					/>
				);

			case 'select':
				return (
					<FormField
						key={fieldConfig.name}
						control={form.control}
						name={fieldConfig.name}
						rules={rules}
						render={({ field, fieldState }) => (
							<FormItem className="w-full">
								<FormLabel className={`gap-1 font-medium text-sm ${fieldState.error ? '' : 'text-gray-700 dark:text-gray-200'}`}>
									{fieldConfig.label}
									{fieldConfig.mandatory && <span className="text-red-500 ml-1">*</span>}
								</FormLabel>
								<div>
									<Select value={field.value} onValueChange={field.onChange} disabled={fieldConfig.disabled} required={fieldConfig.mandatory}>
										<SelectTrigger className="flex h-[50px] w-full rounded-md border border-input bg-background py-2 px-4">
											<SelectValue placeholder={fieldConfig.placeholder || `Select ${fieldConfig.label}`} />
										</SelectTrigger>
										<SelectContent>
											{fieldConfig.options.map((option) => (
												<SelectItem key={option.value} value={option.value}>
													{option.label}
												</SelectItem>
											))}
										</SelectContent>
									</Select>
									<div className="min-h-[20px]">
										<FormMessage />
									</div>
								</div>
							</FormItem>
						)}
					/>
				);

			case 'email':
			case 'text':
			default:
				return (
					<FormField
						key={fieldConfig.name}
						control={form.control}
						name={fieldConfig.name}
						rules={rules}
						render={({ field, fieldState }) => (
							<FormItem className="w-full">
								<FormLabel className={`gap-1 font-medium text-sm ${fieldState.error ? '' : 'text-gray-700 dark:text-gray-200'}`}>
									{fieldConfig.label}
									{fieldConfig.mandatory && <span className="text-red-500 ml-1">*</span>}
								</FormLabel>
								<div>
									<Input
										{...field}
										type={fieldConfig.type}
										disabled={fieldConfig.disabled || fieldConfig.readOnly}
										maxLength={fieldConfig.maxLength}
										className="flex h-[50px] w-full rounded-md border border-input bg-background py-2 px-4"
										placeholder={fieldConfig.placeholder}
										required={fieldConfig.mandatory}
									/>
									<div className="min-h-[20px]">
										<FormMessage />
									</div>
								</div>
							</FormItem>
						)}
					/>
				);
		}
	};

	return (
		<div className="w-full h-screen flex flex-col overflow-hidden bg-gray-50 dark:bg-gray-900">
			<div className="flex-1 overflow-y-auto overflow-x-hidden">
				<div className="p-4 sm:p-6 space-y-4">
					{/* Header */}
					<div className="flex flex-col sm:flex-row justify-between gap-4 items-start sm:items-center bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
						<h2 className="text-2xl font-bold text-gray-800 dark:text-white">{pageTitle}</h2>

						<div className="flex flex-wrap gap-2 items-center">
							<Button onClick={handleAddNew} className="gap-2 h-[40px] bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-md">
								<Plus size={18} />
								<span className="hidden sm:inline">Add New</span>
							</Button>

							<TooltipProvider>
								<Tooltip>
									<TooltipTrigger asChild>
										<Button onClick={handleRefresh} className="h-[40px]" variant="outline" size="sm">
											<RefreshCcw className="stroke-[#9ca3af]" size={18} />
										</Button>
									</TooltipTrigger>
									<TooltipContent>
										Last Refreshed: {lastRefresh ? new Date(lastRefresh).toLocaleString() : 'Never'}
									</TooltipContent>
								</Tooltip>
							</TooltipProvider>

							<Button onClick={handleExport} variant="outline" size="sm" className="gap-2 h-[40px]" disabled={tableData.length === 0 || excelLoading}>
								<Download size={18} />
								<span className="hidden sm:inline">Export</span>
							</Button>

							<label>
								<Button variant="outline" size="sm" className="gap-2 h-[40px]" asChild>
									<span>
										<Upload size={18} />
										<span className="hidden sm:inline">Import</span>
									</span>
								</Button>
								<input type="file" accept=".json" onChange={handleImport} className="hidden" />
							</label>
						</div>
					</div>

					{/* AG Grid Table */}
					<div className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden shadow-md">
						<div className="w-full" style={{ height: '600px', overflowX: 'auto', overflowY: 'auto' }}>
							<div className="w-full h-full min-w-[800px]">
								<AgGridReact
									ref={gridRef}
									rowData={tableData}
									columnDefs={columnDefs}
									defaultColDef={defaultColDef}
									modules={[ColumnsToolPanelModule, SetFilterModule]}
									rowHeight={48}
									cellSelection
									headerHeight={48}
									pagination={true}
									paginationPageSize={20}
									domLayout="normal"
									sideBar={sideBar}
									suppressMovableColumns
									noRowsOverlayComponent={() => <span className="text-gray-500">No records found.</span>}
									className="ag-theme-quartz w-full h-full"
								/>
							</div>
						</div>
					</div>
				</div>
			</div>

			{/* Form Sheet */}
			<Sheet open={showFormSheet} onOpenChange={(open) => {
				if (!open) {
					handleCloseSheet();
				}
			}}>
				<SheetContent side="right" className="w-full sm:max-w-2xl overflow-y-auto">
					<SheetHeader className="mb-6 border-b pb-4">
						<div className="flex items-center justify-between">
							<SheetTitle className="text-2xl font-bold text-gray-800 dark:text-white">
								{editingRow ? `Edit ${entityName}` : `Add New ${entityName}`}
							</SheetTitle>
							<Button
								variant="ghost"
								size="sm"
								onClick={handleCloseSheet}
								className="h-8 w-8 p-0 hover:bg-gray-100 dark:hover:bg-gray-700"
							>
								<X className="h-5 w-5" />
							</Button>
						</div>
					</SheetHeader>

					<Form {...form}>
						<div autoComplete="off" className="space-y-6">
							<div className="space-y-6">
								{sortedFields.map((field) => renderFormField(field))}
							</div>

							<SheetFooter className="flex flex-col sm:flex-row gap-2 pt-6 border-t dark:border-gray-700">
								<Button 
									type="button" 
									size="sm" 
									onClick={handleReset} 
									variant="outline"
									className="gap-2 h-[44px]"
								>
									<RotateCcw size={16} />
									Reset
								</Button>
								
								{editingRow && (
									<Button 
										type="button" 
										size="sm" 
										onClick={handleCompareJSON} 
										className="gap-2 h-[44px] bg-cyan-600 hover:bg-cyan-700 text-white"
									>
										<GitCompare size={16} />
										Compare
									</Button>
								)}

								<Button
									className={`h-[44px] flex-1 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white shadow-md ${!form.formState.isValid ? 'opacity-50 cursor-not-allowed' : ''}`}
									type="button"
									onClick={form.handleSubmit(handleFormSubmit)}
									disabled={!form.formState.isValid}
								>
									{editingRow ? 'Update' : 'Save'}
								</Button>
							</SheetFooter>
						</div>
					</Form>
				</SheetContent>
			</Sheet>

			{/* Cancel Dialog */}
			<Dialog open={showCancelDialog} onOpenChange={setShowCancelDialog}>
				<DialogContent>
					<DialogHeader>
						<DialogTitle>Unsaved Changes</DialogTitle>
						<DialogDescription>
							You have unsaved changes. Are you sure you want to close without saving? All changes will be lost.
						</DialogDescription>
					</DialogHeader>
					<DialogFooter className="flex justify-end gap-2">
						<Button variant="outline" onClick={() => setShowCancelDialog(false)}>
							Continue Editing
						</Button>
						<Button variant="destructive" onClick={handleCancelConfirm}>
							Discard Changes
						</Button>
					</DialogFooter>
				</DialogContent>
			</Dialog>

			{/* Delete Dialog */}
			<Dialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>
				<DialogContent>
					<DialogHeader>
						<DialogTitle>Delete {entityName}</DialogTitle>
						<DialogDescription>
							Are you sure you want to delete this {entityName}? This action cannot be undone and all data will be permanently removed.
						</DialogDescription>
					</DialogHeader>
					<DialogFooter className="flex justify-end gap-2">
						<Button variant="outline" onClick={handleDeleteCancel}>
							Cancel
						</Button>
						<Button variant="destructive" onClick={handleDeleteConfirm}>
							Delete Permanently
						</Button>
					</DialogFooter>
				</DialogContent>
			</Dialog>

			{/* Compare Dialog */}
			{showCompareDialog && (
				<Dialog open={showCompareDialog} onOpenChange={setShowCompareDialog}>
					<DialogContent className="max-w-4xl max-h-[90vh] overflow-auto">
						<DialogHeader>
							<DialogTitle>Compare JSON</DialogTitle>
						</DialogHeader>
						<div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
							<div>
								<h3 className="font-semibold mb-2 text-sm dark:text-white">Original</h3>
								<pre className="bg-gray-100 dark:bg-gray-900 p-3 rounded text-xs overflow-auto max-h-96">
									{JSON.stringify(compareData.original, null, 2)}
								</pre>
							</div>
							<div>
								<h3 className="font-semibold mb-2 text-sm dark:text-white">Modified</h3>
								<pre className="bg-gray-100 dark:bg-gray-900 p-3 rounded text-xs overflow-auto max-h-96">
									{JSON.stringify(compareData.modified, null, 2)}
								</pre>
							</div>
						</div>
						<DialogFooter>
							<Button variant="outline" onClick={() => setShowCompareDialog(false)}>
								Close
							</Button>
						</DialogFooter>
					</DialogContent>
				</Dialog>
			)}
		</div>
	);
}
----------------------------------------------------------------------------
// src/pages/UserManagement.jsx - Updated to use ConfigManager
import React from 'react';
import ConfigManager from '@/components/ConfigManager';
import { userManagementConfig } from '@/config/userManagementConfig';

export default function UserManagement() {
	return <ConfigManager config={userManagementConfig} />;
}
-------------------------------
// src/components/Sidebar.jsx - Enhanced with better design and logout
import React from 'react';
import { ChevronDown, ChevronRight, X, LogOut } from 'lucide-react';
import * as LucideIcons from 'lucide-react';
import { useSignals } from '@preact/signals-react/runtime';
import {
	menuConfig,
	currentRoute,
	navigateTo,
	sidebarOpen,
	sidebarCollapsed,
	toggleSidebarCollapse,
	toggleSidebar,
	openMenus,
	toggleMenu,
} from '../store/configStore';
import { logout, currentUser } from '@/store/authStore';
import { toast } from 'sonner';

export default function Sidebar() {
	useSignals();
	const items = menuConfig.value.items;
	const activePath = currentRoute.value;
	const isOpen = sidebarOpen.value;
	const isCollapsed = sidebarCollapsed.value;
	const openedMenus = openMenus.value;
	const user = currentUser.value;

	const handleNavigate = (path) => {
		navigateTo(path);
		if (window.innerWidth < 1024) {
			toggleSidebar();
		}
	};

	const handleLogout = () => {
		logout();
		navigateTo('/login');
		toast.success('Logged out successfully');
	};

	const renderIcon = (iconName) => {
		const IconComponent = LucideIcons[iconName];
		return IconComponent ? <IconComponent size={20} /> : null;
	};

	const renderMenuItem = (item) => {
		const isActive = activePath === item.path;
		const hasSubmenu = item.submenu && item.submenu.length > 0;
		const isMenuOpen = openedMenus[item.id] || false;

		if (hasSubmenu) {
			return (
				<div key={item.id} className="mb-1">
					<button
						onClick={() => toggleMenu(item.id)}
						className={`w-full flex items-center justify-between px-4 py-3 rounded-lg transition-all duration-200 ${
							isCollapsed
								? 'justify-center'
								: 'hover:bg-blue-50 dark:hover:bg-gray-800'
						} group`}
					>
						<div className="flex items-center gap-3 min-w-0">
							<div className="text-gray-600 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 flex-shrink-0">
								{renderIcon(item.icon)}
							</div>
							{!isCollapsed && (
								<span className="font-medium text-gray-700 dark:text-gray-200 group-hover:text-blue-600 dark:group-hover:text-blue-400 truncate">
									{item.title}
								</span>
							)}
						</div>
						{!isCollapsed && (
							<div className="flex-shrink-0">
								{isMenuOpen ? (
									<ChevronDown className="text-gray-400" size={18} />
								) : (
									<ChevronRight className="text-gray-400" size={18} />
								)}
							</div>
						)}
					</button>

					{!isCollapsed && isMenuOpen && (
						<div className="ml-8 mt-1 space-y-1 border-l-2 border-gray-200 dark:border-gray-700 pl-4">
							{item.submenu.map((subItem) => {
								const isSubActive = activePath === subItem.path;
								return (
									<button
										key={subItem.id}
										onClick={() => handleNavigate(subItem.path)}
										className={`w-full text-left px-4 py-2.5 rounded-lg transition-all duration-200 ${
											isSubActive
												? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-md'
												: 'text-gray-600 dark:text-gray-400 hover:bg-blue-50 dark:hover:bg-gray-800 hover:text-blue-600 dark:hover:text-blue-400'
										}`}
									>
										<span className="text-sm font-medium">{subItem.title}</span>
									</button>
								);
							})}
						</div>
					)}
				</div>
			);
		}

		return (
			<button
				key={item.id}
				onClick={() => handleNavigate(item.path)}
				className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 mb-1 ${
					isCollapsed ? 'justify-center' : ''
				} ${
					isActive
						? 'bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-md'
						: 'text-gray-700 dark:text-gray-200 hover:bg-blue-50 dark:hover:bg-gray-800 hover:text-blue-600 dark:hover:text-blue-400'
				}`}
			>
				<div className="flex-shrink-0">{renderIcon(item.icon)}</div>
				{!isCollapsed && <span className="font-medium truncate">{item.title}</span>}
			</button>
		);
	};

	return (
		<>
			{/* Mobile Overlay */}
			{isOpen && (
				<div
					className="fixed inset-0 bg-black/50 z-40 lg:hidden"
					onClick={toggleSidebar}
				/>
			)}

			{/* Sidebar */}
			<aside
				className={`fixed lg:relative inset-y-0 left-0 z-40 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 flex flex-col shadow-xl lg:shadow-none ${
					isOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'
				} ${isCollapsed ? 'w-20' : 'w-64'}`}
			>
				{/* Header */}
				<div className="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
					{!isCollapsed && (
						<div className="flex items-center gap-2 min-w-0">
							<div className="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-md">
								P
							</div>
							<span className="font-bold text-lg text-gray-800 dark:text-white truncate">PrismIQ</span>
						</div>
					)}
					<div className="flex items-center gap-2">
						<button
							onClick={toggleSidebarCollapse}
							className="hidden lg:block p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors"
							aria-label="Toggle sidebar"
						>
							{isCollapsed ? (
								<ChevronRight className="text-gray-600 dark:text-gray-400" size={20} />
							) : (
								<ChevronRight className="text-gray-600 dark:text-gray-400 rotate-180" size={20} />
							)}
						</button>
						<button
							onClick={toggleSidebar}
							className="lg:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors"
							aria-label="Close sidebar"
						>
							<X className="text-gray-600 dark:text-gray-400" size={20} />
						</button>
					</div>
				</div>

				{/* User Info */}
				{user && !isCollapsed && (
					<div className="p-4 border-b border-gray-200 dark:border-gray-700">
						<div className="flex items-center gap-3">
							<div className="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold shadow-md">
								{user.username.charAt(0).toUpperCase()}
							</div>
							<div className="flex-1 min-w-0">
								<p className="text-sm font-semibold text-gray-800 dark:text-white truncate">
									{user.username}
								</p>
								<p className="text-xs text-gray-500 dark:text-gray-400">Administrator</p>
							</div>
						</div>
					</div>
				)}

				{/* Navigation */}
				<nav className="flex-1 p-4 overflow-y-auto">
					{items.map((item) => renderMenuItem(item))}
				</nav>

				{/* Logout Button */}
				{user && (
					<div className="p-4 border-t border-gray-200 dark:border-gray-700">
						<button
							onClick={handleLogout}
							className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all duration-200 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 ${
								isCollapsed ? 'justify-center' : ''
							}`}
						>
							<LogOut size={20} className="flex-shrink-0" />
							{!isCollapsed && <span className="font-medium">Logout</span>}
						</button>
					</div>
				)}
			</aside>
		</>
	);
}
-------------------------------------------------------------
// src/registry/componentRegistry.js - Updated with Login
import { lazy } from 'react';

export const pageRegistry = {
  Home: lazy(() => import('../pages/Home')),
  UserManagement: lazy(() => import('../pages/UserManagement')),
  Constants: lazy(() => import('../pages/config/Constants')),
  FormSettings: lazy(() => import('../pages/config/FormSettings')),
  TableSettings: lazy(() => import('../pages/config/TableSettings')),
  Login: lazy(() => import('../pages/Login')),
};
----------------------------------------------------------------
// src/store/configStore.js - Updated with login route
import { signal, computed} from '@preact/signals-react';
import headerConfigData from '../config/header.json';
import menuConfigData from '../config/menu.json';
import pagesConfigData from '../config/pages.json';

export const headerConfig = signal(headerConfigData);
export const menuConfig = signal(menuConfigData);
export const pagesConfig = signal(pagesConfigData);
export const currentRoute = signal(window.location.pathname || '/');

// Sidebar states
export const sidebarOpen = signal(window.innerWidth >= 1024);
export const sidebarCollapsed = signal(false);
export const openMenus = signal({});

export const allRoutes = computed(() => {
  const routes = [];
  
  // Add login route
  routes.push({ path: '/login', component: 'Login' });
  
  // Add menu routes
  menuConfig.value.items.forEach(item => {
    if (item.component) {
      routes.push({ path: item.path, component: item.component });
    }
    if (item.submenu) {
      item.submenu.forEach(sub => {
        routes.push({ path: sub.path, component: sub.component });
      });
    }
  });
  return routes;
});

export const navigateTo = (path) => {
  console.log('Navigating to:', path);
  window.history.pushState({}, '', path);
  currentRoute.value = path;
};

// Handle browser back/forward
if (typeof window !== 'undefined') {
  window.addEventListener('popstate', () => {
    currentRoute.value = window.location.pathname;
  });

  // Handle initial page load with correct route
  window.addEventListener('DOMContentLoaded', () => {
    currentRoute.value = window.location.pathname;
  });
}

export const toggleSidebar = () => {
  sidebarOpen.value = !sidebarOpen.value;
};

export const toggleSidebarCollapse = () => {
  sidebarCollapsed.value = !sidebarCollapsed.value;
  if (sidebarCollapsed.value) {
    openMenus.value = {};
  }
};

export const toggleMenu = (id) => {
  console.log('toggleMenu called with id:', id);
  console.log('Current openMenus:', openMenus.value);
  
  const currentMenus = { ...openMenus.value };
  currentMenus[id] = !currentMenus[id];
  
  console.log('New openMenus:', currentMenus);
  openMenus.value = currentMenus;
};

export const updateHeaderConfig = (updates) => {
  headerConfig.value = {
    ...headerConfig.value,
    ...updates
  };
};
---------------------------------------------
// src/App.jsx - Updated with authentication check
import React, { useEffect, useState } from 'react';
import { currentRoute } from './store/configStore';
import { isAuthenticated } from './store/authStore';
import Sidebar from './components/Sidebar';
import Header from './components/Header';
import Router from './components/Router';

export default function App() {
  const [route, setRoute] = useState(currentRoute.value);
  const [authenticated, setAuthenticated] = useState(isAuthenticated.value);

  useEffect(() => {
    const unsubscribeRoute = currentRoute.subscribe((val) => {
      setRoute(val);
    });

    const unsubscribeAuth = isAuthenticated.subscribe((val) => {
      setAuthenticated(val);
    });

    const handlePopState = () => {
      currentRoute.value = window.location.pathname;
    };
    
    window.addEventListener('popstate', handlePopState);
    
    return () => {
      unsubscribeRoute();
      unsubscribeAuth();
      window.removeEventListener('popstate', handlePopState);
    };
  }, []);

  // Show login page without sidebar and header
  if (route === '/login') {
    return (
      <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
        <Router key={route} />
      </div>
    );
  }

  // Show main layout with sidebar and header for authenticated users
  return (
    <div className="flex min-h-screen bg-gray-50 dark:bg-gray-900">
      {authenticated && <Sidebar />}
      <div className="flex-1 flex flex-col min-w-0">
        {authenticated && <Header />}
        <main className="flex-1 overflow-auto">
          <Router key={route} />
        </main>
      </div>
    </div>
  );
}
----------------------------------------------